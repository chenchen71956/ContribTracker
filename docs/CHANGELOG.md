# 变更日志

## [1.0.5] - 2025-06-09

### 错误修复
- 修复 contributors 表外键约束错误问题
- 移除自引用外键设计，增强数据完整性
- 添加级联删除支持，确保数据一致性

### 代码改进
- 实现数据库表结构自动升级机制
- 优化数据备份和恢复流程
- 增强数据库操作异常处理

## [1.0.4] - 2025-06-09

### 错误修复
- 修复删除贡献时的外键约束错误，实现级联删除
- 修复WebSocket端口绑定失败问题，增加端口可用性检测
- 优化LogHelper工具类，统一日志输出格式

### 代码改进
- 在数据库操作中添加事务支持，确保操作的原子性
- 添加端口自动选择机制，提高WebSocket服务的可靠性
- 优化缓存清理逻辑，在数据变更后及时更新缓存

## [1.0.3] - 2025-06-09

### 错误修复
- 修复所有编译错误
- 修复类型转换问题（long/int, String/UUID）
- 修复lambda表达式中的返回类型错误
- 修复缓存Map类型不匹配问题
- 修复WebSocket在数据库初始化前尝试刷新缓存的问题
- 修复组件初始化顺序问题导致的运行时异常

### 代码改进
- 添加HikariCP和slf4j依赖到构建脚本
- 改进错误处理机制
- 优化lambda表达式上下文处理
- 添加数据库初始化状态跟踪
- 实现组件初始化依赖链，确保正确的启动顺序
- 添加系统组件定期检查和自动恢复机制

## [1.0.2] - 2025-05-12

### 错误修复
- 修复类型转换错误导致编译失败问题
- 修复UUID处理不正确问题
- 修复数据库方法参数类型不匹配问题

### 代码改进
- 添加Contribution类深拷贝功能
- 实现ContribPermissionManager.getContributorLevel方法
- 添加DatabaseManager.findPlayerByName方法
- 优化重复代码，添加方法重载

## [1.0.1] - 2025-05-11

### 性能优化
- 实现多线程处理，避免在主线程执行耗时操作
- 添加HikariCP数据库连接池
- 优化WebSocket消息发送和处理
- 实现数据缓存机制减少数据库访问
- 批量处理网络消息降低资源消耗

### 错误修复
- 修复服务器TPS下降问题
- 修复WebSocket连接泄漏导致的内存问题
- 修复数据库连接未及时关闭的问题
- 修正命令执行过程中的阻塞问题

### 其他改进
- 添加LogHelper工具类规范日志输出格式
- 改进错误处理和日志记录
- 优化资源关闭流程
- 添加性能监控指标
- 代码结构重构提升可维护性

## [1.0.0] - 2025-05-06

### 初始功能
- 贡献创建和管理功能
- 贡献者权限系统
- 位置追踪和搜索
- 命令系统实现
- WebSocket数据同步接口

## [1.0.6] - 2025-06-09

### 功能增强
- 重构 `/contribtracker add` 命令系统，提升用户体验
- 添加玩家列表展示功能，支持点击交互
- 实现贡献类型自动检测
- 优化命令参数处理，提高容错性

### 用户体验
- 添加交互式命令建议功能
- 改进命令执行反馈信息
- 提供更直观的命令执行过程状态

### 安全性改进
- 加强命令权限控制，限制敏感操作权限
- 为 `/contribtracker add player {contribId} {playerName}` 命令添加管理员权限验证
- 移除普通玩家添加贡献者的功能，防止权限滥用
- 简化权限检查逻辑，提高安全性

## [1.0.7] - 2025-06-09

### 功能增强
- 实现命令参数自动补全功能
  - 玩家名称根据在线玩家列表自动补全
  - 贡献ID通过异步数据库查询提供补全建议
  - 贡献类型基于预定义类型列表补全
- 优化命令输入体验，提高用户操作效率
- 命令补全功能使用异步处理，避免性能影响

## [1.0.9] - 2025-06-09

### 功能改进
- 优化 `/contribtracker add type` 命令结构
  - 拆分为贡献类型和贡献名称两个独立参数
  - 命令格式更改为 `/contribtracker add type {type} {name}`
  - 类型参数提供自动补全，输入后直接继续输入名称
  - 提高命令输入流畅度和用户体验
- 确保贡献ID补全功能在所有相关命令中正确应用
- 简化内部命令处理逻辑，提高代码可维护性

## [1.0.8] - 2025-06-09

### 功能改进
- 重新调整 `/contribtracker add player` 命令结构，提升用户体验
  - 命令参数顺序调整为优先输入玩家名，再输入贡献ID
  - 优化对在线玩家的补全建议，提升操作便捷性
  - 保留手动输入离线玩家名称的功能
- 命令系统符合用户直观使用习惯，降低记忆和使用成本

## [1.0.10] - 2025-06-09

### 性能优化
- 优化日志输出系统，减少日志流量
- 使用特殊标记机制，只显示关键系统事件
- 实现智能日志过滤，提高运行时性能

### 用户体验
- 精简控制台输出，仅保留重要信息
- 高亮显示WebSocket地址和系统状态信息
- 降低日志噪音，便于问题排查

### 代码改进
- 增强LogHelper工具类，添加特殊标记功能
- 使用slf4j的Marker和Filter机制实现高级过滤
- 统一系统事件日志格式，提升可读性

## [1.0.11] - 2025-06-09

### 性能优化
- 进一步减少日志输出，严格限制只显示关键信息
- 移除所有非必要的INFO级别日志，包括数据库和关闭日志
- 优化日志过滤机制，使用精确的标记过滤方式

### 系统行为
- 只输出启动信息和WebSocket地址
- 自动忽略所有低于WARN级别的日志
- 保留错误和警告信息确保问题诊断能力

### 代码改进
- 重构LogHelper工具类，移除不必要的方法
- 使用多级过滤器链优化日志控制
- 将非关键日志降级为debug级别

## [1.0.12] - 2025-06-09

### 极简化
- 合并所有启动信息为单一友好消息
- 精简为"ContribTrackerMod已加载，连接地址为：xxx"格式
- 完全移除其他所有启动和关闭信息

### 用户体验
- 使用更直观的日志文本
- 突出显示关键连接信息
- 减少控制台噪音提高可读性

### 代码优化
- 清理各组件中多余的日志输出
- 移除DatabaseManager中的信息性日志
- 移除所有组件中的重复启动信息 